<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>選擇取貨門市</title>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
    select, button { padding: 8px; margin-top: 10px; }
    .note { font-size: 0.9em; color: #666; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>🏪 選擇超商與取貨門市</h2>

  <label for="subType">請選擇超商：</label>
  <select id="subType">
    <option value="FAMI">全家</option>
    <option value="UNIMART">7-ELEVEN</option>
    <option value="HILIFE">萊爾富</option>
  </select>

  <br />
  <button id="openMap">📍 開啟門市地圖</button>

  <p class="note">👉 選擇門市後將跳回物流訂單頁，並自動帶入門市資訊</p>

  <script>
    document.getElementById('openMap').addEventListener('click', () => {
      const subType = document.getElementById('subType').value;
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = 'https://logistics-stage.ecpay.com.tw/Express/map';
      form.target = '_blank';

      const now = Date.now();

      const clientReplyUrl = `https://chunzhi-care.onrender.com/logistics-test.html?subtype=${subType}`;

      const fields = {
        MerchantID: '2000132',
        MerchantTradeNo: 'MAP' + now,
        LogisticsType: 'CVS',
        LogisticsSubType: subType,
        IsCollection: 'N',
        ServerReplyURL: 'https://chunzhi-care.onrender.com/api/logistics/cvs-store-reply',
        ClientReplyURL: clientReplyUrl
      };

      Object.entries(fields).forEach(([key, val]) => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = key;
        input.value = val;
        form.appendChild(input);
      });

      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);
    });
  </script>
</body>
</html>