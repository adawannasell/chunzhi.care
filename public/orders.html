<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘çš„è¨‚å–® | æ˜¥æ Chun-Zhi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Serif TC', serif;
    }
  </style>
</head>
<body class="bg-[#fdf4e7] text-[#1a1a1a] min-h-screen px-4 py-10">
  <div class="max-w-4xl mx-auto bg-white shadow rounded-xl p-8">
    <h1 class="text-2xl font-bold mb-6">æˆ‘çš„è¨‚å–®</h1>
    <div id="orders" class="space-y-6">
      <p>è¼‰å…¥ä¸­...</p>
    </div>
  </div>

  <footer class="text-xs text-gray-500 mt-8 text-center">
    <p>Â© 2025 æ˜¥æ CHUN-ZHI</p>
    <p>support@chunzhi.comï½œ@chunzhi_care</p>
  </footer>

 <script>
  fetch('/me')
    .then(res => res.json())
    .then(user => {
      if (!user.name) {
        window.location.href = '/login.html';
        return;
      }

      fetch('/api/orders')
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById('orders');
          if (!data.length) {
            container.innerHTML = '<p>ç›®å‰æ²’æœ‰è¨‚å–®ç´€éŒ„ã€‚</p>';
            return;
          }

          container.innerHTML = data.map(order => {
            const logisticsHtml = order.logistics_id
              ? `<button onclick="checkLogistics('${order.logistics_id}')" class="mt-2 px-3 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-800">ğŸ“¦ æŸ¥è©¢ç‰©æµ</button>`
              : '<p class="text-sm text-gray-400 mt-2">å°šç„¡ç‰©æµè³‡è¨Š</p>';

            return `
              <div class="border border-gray-200 rounded-lg p-4">
                <p class="text-sm"><strong>è¨‚è³¼æ—¥æœŸï¼š</strong> ${new Date(order.created_at).toLocaleString()}</p>
                <p class="text-sm"><strong>è¨‚è³¼äººï¼š</strong> ${order.name}</p>
                <p class="text-sm"><strong>æ”¶ä»¶åœ°å€ï¼š</strong> ${order.address}</p>
                <p class="text-sm"><strong>å‚™è¨»ï¼š</strong> ${order.note || 'ç„¡'}</p>
                <p class="text-sm"><strong>ç‹€æ…‹ï¼š</strong> ${order.status}</p>
                <p class="text-sm mt-2"><strong>å•†å“å…§å®¹ï¼š</strong></p>
                <ul class="list-disc list-inside">
                  ${order.cart_items.map(item => `<li>${item.name} x${item.qty}</li>`).join('')}
                </ul>
                ${logisticsHtml}
              </div>
            `;
          }).join('');
        })
        .catch(err => {
          console.error('âŒ è¼‰å…¥å¤±æ•—:', err);
          document.getElementById('orders').innerHTML = '<p class="text-red-600">ç„¡æ³•è¼‰å…¥è¨‚å–®è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>';
        });
    })
    .catch(() => {
      window.location.href = '/login.html';
    });

  function checkLogistics(logisticsId) {
    if (!logisticsId) {
      alert('â— ç¼ºå°‘ç‰©æµå–®è™Ÿ');
      return;
    }
    window.open(`/api/logistics/status/${logisticsId}`, '_blank');
  }
</script>

</body>
</html>